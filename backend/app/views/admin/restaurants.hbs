{{> sidebar }}
<div id="content-wrapper">

    <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="">Admin</a>
            </li>
            <li class="breadcrumb-item active">Restaurants</li>
        </ol>

        {{#if success }}
            <div class="alert alert-success">
                {{{ success }}}
            </div>
        {{/if}}

        {{#if error }}
            <div class="alert alert-danger">
                {{{ error }}}
            </div>
        {{/if}}


        <div class="card w-75">
            <div class="card-header">Add new restaurant</div>
            <div class="card-body">


                <form action="/addRestaurant" method="post">
                    <div class="row">
                        <div class="col-sm-4">
                            <input type="text" class="form-control" name="name" placeholder="Name" required>
                        </div>

                        <div class="col-sm-4">
                            <select class="form-control" name="townId">
                                {{#each towns}}
                                    <option value="{{{this.id}}}">{{{this.name}}}</option>
                                {{/each}}

                            </select>
                        </div>
                        <div class="col-sm-4">
                            <button type="submit" class="btn btn-primary">Add</button>
                        </div>

                    </div>

                </form>

            </div>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Town</th>
                        <th>Menu</th>
                        <th>Update</th>
                        <th>Delete</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{#each restaurants}}
                        <tr>
                            <td>{{{this.name}}}</td>
                            <td>{{{this.town.name}}}</td>

                            <td><a href="/restaurants/{{{this.id}}}">View Menu </a></td>

                            <td>
                                <button data-toggle="modal" data-target="#updateRestaurant"
                                        onclick="updateRestaurant('{{{this.id}}}', '{{{this.name}}}', '{{{this.town.id}}}')">
                                    Update
                                </button>
                            </td>

                            <td>

                                <form method="post" action="/deleteRestaurant" class="d-inline">

                                    <input type="hidden" value="{{{ this.id}}}" name="id">

                                    <button type="submit">Delete</button>
                                </form>
                            </td>

                        </tr>
                    {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!--modal-->
<div class="modal fade" id="updateRestaurant" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Update </h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                </button>
            </div>

            <div class="modal-body">
                <form action="/updateRestaurant" method="post">
                    <div class="row">
                        <input type="hidden" id="resId" name="id">
                        <div class="col-sm-4">
                            <input type="text" id="resName" class="form-control" name="name" placeholder="Name"
                                   required>
                        </div>

                        <div class="col-sm-4">
                            <select class="form-control" name="townId" required id="resTown">
                                {{#each towns}}
                                    <option value="{{{this.id}}}">{{{this.name}}}</option>
                                {{/each}}

                            </select>
                        </div>
                        <div class="col-sm-4">
                            <button type="submit" class="btn btn-primary">Update</button>
                        </div>

                    </div>

                </form>

            </div>

        </div>
    </div>
</div>

<script>
    function updateRestaurant(id, name, townId) {
        $('#resId').val(id);
        $('#resName').val(name);
        $('#resTown').val(townId);
    }
</script>


